<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Document</title>

	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" />
	<!-- Google Fonts Roboto -->
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" />
	<!-- MDB -->
	<link rel="stylesheet" href="css/mdb.min.css" />

	<link rel="stylesheet" href="css/style.css" />

	<link rel="stylesheet" href="css/dashboard.css" />
</head>

<body>
	<div class="d-flex flex-column justify-content-between" style="min-height: 100vh;">
		<div>
			<header id="mainHeader">
				<nav class="navbar fixed-top shadow-3-strong navbar-expand-lg navbar-light bg-light">
					<!-- Container wrapper -->
					<div class="container">
						<!-- Navbar brand -->
						<a class="navbar-brand" href="/">
							<img src="immagini/logo3.png" class="me-2" height="32" alt="Greenshare Logo" loading="lazy"
								style="margin-top: -1px" />
							<span class="text-success">Green</span>Share
						</a>
						<!-- Toggle button -->
						<button class="navbar-toggler" type="button" data-mdb-toggle="offcanvas"
							data-mdb-target="#offcanvasRight" aria-controls="offcanvasRight" aria-expanded="false"
							aria-label="Toggle navigation">
							<i class="fas fa-bars"></i>
						</button>
						<!-- Collapsible wrapper -->
						<div class="collapse navbar-collapse" id="navbarButtonsExample">
							<!-- Left links -->
							<ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul>
							<!-- Left links -->
							<div class="d-flex align-items-center">
								<button type="button" class="btn btn-link text-success px-3 me-2">
									Login
								</button>
								<button type="button" class="btn btn-success me-3">
									Registrati
								</button>
								<ul class="navbar-nav">
									<li class="nav-item dropdown">
										<a class="nav-link dropdown-toggle hidden-arrow" href="#" role="button"
											data-mdb-toggle="dropdown" aria-expanded="false">
											<i class="fas fa-user text-dark"></i>
										</a>
										<ul class="dropdown-menu dropdown-menu-end"
											aria-labelledby="navbarDropdownMenuLink">
											<li>
												<a class="dropdown-item" href="#">Il mio profilo</a>
											</li>
											<li>
												<a class="dropdown-item" href="#">Logout</a>
											</li>
										</ul>
									</li>
									<!-- Notification dropdown -->
								</ul>
							</div>
							<!-- Collapsible wrapper -->
						</div>
						<!-- Container wrapper -->
					</div>
				</nav>
				<!-- Fine Navbar -->
			</header>
			<!-- Offcanvas -->
			<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight"
				aria-labelledby="offcanvasRightLabel">
				<div class="offcanvas-header">
					<h5 id="offcanvasRightLabel" class="text-light">Menù</h5>
					<button type="button" class="btn-close text-reset" data-mdb-dismiss="offcanvas"
						aria-label="Close"></button>
				</div>
				<div class="offcanvas-body">
					<button type="button" class="btn btn-link text-success">
						Login</button><br />
					<button type="button" class="btn btn-link text-success">
						Registrati
					</button>
				</div>
				<div class="py-2 d-flex justify-content-between align-items-center">
					<button type="button" class="btn btn-success ms-4">
						Prenota Ora
					</button>
					<div>
						<!-- Right -->
						<a href="https://www.facebook.com/carsharingasti" class="me-4 text-reset zoom2">
							<i class="fab fa-facebook-f"></i>
						</a>
						<a href="https://twitter.com/carsharingpa" class="me-4 text-reset zoom2">
							<i class="fab fa-twitter"></i>
						</a>
						<a href="https://www.instagram.com/carsharingasti/" class="me-4 text-reset zoom2">
							<i class="fab fa-instagram"></i>
						</a>
						<!-- Right -->
					</div>
				</div>
			</div>
			<!-- Fine Offcanvas -->
			<main>
				<div class="container p-5">
					<div class="d-flex justify-content-end">
						<button type="button" id="btnAddVehicle" class="btn btn-success mb-3">
							<i class="fas fa-plus"></i> Aggiungi
						</button>
					</div>
					<div class="accordion accordion-flush bg-white rounded p-4" id="accordionFlush">
						<div class="accordion-item" th:each="vehicle : ${vehicles}">
							<form action="#" th:action="@{update/vehicle}" th:object="${vehicle}" method="post">
								<h2 class="accordion-header" th:id="'flush-heading-' + ${vehicle.id}">
									<button class="accordion-button collapsed" type="button" data-mdb-toggle="collapse"
										th:data-mdb-target="'#flush-collapse-' + ${vehicle.id}" aria-expanded="false"
										th:aria-controls="'flush-collapse-' + ${vehicle.id}"
										th:text="'#' + ${vehicle.id} + ' - ' + ${vehicle.description}"></button>
								</h2>
								<div th:id="'flush-collapse-' + ${vehicle.id}" class="accordion-collapse collapse"
									th:aria-labelledby="'flush-heading-' + ${vehicle.id}"
									data-mdb-parent="#accordionFlush">
									<div class="accordion-body">
										<input type="hidden" name="id" id="id" th:value="${vehicle.id}">
										<div class="d-flex justify-content-evenly flex-wrap">
											<div class="position-relative mb-4">
												<img src="/immagini/toyota_yaris.png"
													class="position-absolute start-50 translate-middle-x" alt=""
													width="64px">
												<input type="text" class="invisible">
											</div>
											<div class="mb-4">
												<span class="position-absolute">#</span>
												<input type="number" class="text-center" th:value="${vehicle.id}"
													placeholder="ID" th:disabled="${true}" />
											</div>
											<div class="mb-4">
												<input class="text-center" type="text" name="description"
													id="description" placeholder="Descrizione"
													th:value="${vehicle.description}" />
											</div>
										</div>
										<div class="d-flex justify-content-evenly flex-wrap">
											<div class="position-relative mb-4">
												<input class="text-center" type="number" name="maxAutonomy"
													id="maxAutonomy" placeholder="Autonomia massima"
													th:value="${vehicle.maxAutonomy}" />
												<span class="position-absolute end-0 me-2">km</span>
											</div>
											<div class="mb-4">
												<input type="text" class="text-center" name="creationDate"
													id="creationDate"
													th:value="${#dates.format(vehicle.creationDate, 'yyyy-MM-dd HH:mm:ss')}"
													readonly>
											</div>
											<div class="position-relative mb-4">
												<input class="text-center" type="number" name="pricePerMinute"
													id="pricePerMinute" placeholder="Prezzo al minuto"
													th:value="${vehicle.pricePerMinute}" />
												<span class="position-absolute end-0 me-2">€</span>
											</div>
										</div>
										<div class="d-flex justify-content-evenly flex-wrap">
											<div class="position-relative mb-4">
												<input class="text-center" type="number" name="battery" id="battery"
													placeholder="Livello batteria" th:value="${vehicle.battery}" />
												<span class="position-absolute end-0 me-2">%</span>
											</div>
											<div class="mb-4">
												<input class="text-center" type="text" name="type" id="type"
													placeholder="Tipo" th:value="${vehicle.type}" />
											</div>
											<div class="mb-4">
												<input class="text-center" type="text" name="currentLocation"
													id="currentLocation" placeholder="Posizione attuale"
													th:value="${vehicle.currentLocation}" />
											</div>
										</div>
										<div class="d-flex justify-content-center flex-wrap">
											<button type="button" class="btnDeleteVehicle btn btn-danger me-2"
												data-mdb-toggle="modal" data-mdb-target="#deleteVehicleModal"
												th:data-vehicle-id="${vehicle.id}">
												Elimina
											</button>
											<button type="submit" class="btn btn-success">
												Salva
											</button>
										</div>
									</div>
								</div>
							</form>
						</div>
						<div class="accordion-item" id="new-accordion-item">
							<h2 class="accordion-header" id="flush-heading-new">
								<button class="accordion-button collapsed" type="button" data-mdb-toggle="collapse"
									data-mdb-target="#flush-collapse-new" aria-expanded="false"
									aria-controls="flush-collapse-new">
									Nuovo elemento
								</button>
							</h2>
							<div id="flush-collapse-new" class="accordion-collapse collapse"
								aria-labelledby="flush-heading-new" data-mdb-parent="#accordionFlush">
								<div class="accordion-body">
									<div class="d-flex justify-content-evenly flex-wrap">
										<div class="position-relative mb-4">
											<img src="/immagini/toyota_yaris.png"
												class="position-absolute start-50 translate-middle-x" alt=""
												width="64px">
											<input type="text" class="invisible">
										</div>
										<div class="mb-4">
											<span class="position-absolute">#</span>
											<input type="number" class="text-center" placeholder="ID" disabled />
										</div>
										<div class="mb-4">
											<input class="text-center" type="text" name="newDescription"
												id="newDescription" placeholder="Descrizione" />
										</div>
									</div>
									<div class="d-flex justify-content-evenly flex-wrap">
										<div class="position-relative mb-4">
											<input class="text-center" type="number" name="newMaxAutonomy"
												id="newMaxAutonomy" placeholder="Autonomia massima" />
											<span class="position-absolute end-0 me-2">km</span>
										</div>
										<div class="mb-4">
											<input type="text" class="text-center" name="newCreationDate"
												id="newCreationDate" value="yyyy-MM-dd" disabled>
										</div>
										<div class="position-relative mb-4">
											<input class="text-center" type="number" name="newPricePerMinute"
												id="newPricePerMinute" placeholder="Prezzo al minuto" />
											<span class="position-absolute end-0 me-2">€</span>
										</div>
									</div>
									<div class="d-flex justify-content-evenly flex-wrap">
										<div class="position-relative mb-4">
											<input class="text-center" type="number" name="newBattery" id="newBattery"
												placeholder="Livello batteria" />
											<span class="position-absolute end-0 me-2">%</span>
										</div>
										<div class="mb-4">
											<input class="text-center" type="text" name="newType" id="newType"
												placeholder="Tipo" />
										</div>
										<div class="mb-4">
											<input class="text-center" type="text" name="newCurrentLocation"
												id="newCurrentLocation" placeholder="Posizione attuale" />
										</div>
									</div>
									<div class="d-flex justify-content-center">
										<button type="button" class="btn btn-success" id="btnConfermAddVehicle">
											Aggiungi
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>
	</div>

	<!-- Conferm Delete Vehicle Modal -->
	<div class="modal fade" id="deleteVehicleModal" tabindex="-1" aria-labelledby="deleteVehicleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="deleteVehicleModalLabel">Sei sicuro di voler eliminare il veicolo?
					</h5>
					<button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body text-center">
					<button type="button" class="btn btn-light" data-mdb-dismiss="modal">
						Annulla
					</button>
					<button type="button" id="btnConfermDeleteVehicle" class="btn btn-danger" data-mdb-dismiss="modal">
						Conferma
					</button>
				</div>
			</div>
		</div>
	</div>

	<footer class="text-center text-lg-start bg-success">
		<!-- Section: Social media -->
		<section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom text-white">
			<!-- Left -->
			<div class="me-5 d-none d-lg-block">
				<span>Get connected with us on social networks:</span>
			</div>
			<!-- Left -->
			<!-- Right -->
			<div class="">
				<a href="https://www.facebook.com/carsharingasti" class="me-4 text-reset zoom2">
					<i class="fab fa-facebook-f"></i>
				</a>
				<a href="https://twitter.com/carsharingpa" class="me-4 text-reset zoom2">
					<i class="fab fa-twitter"></i>
				</a>
				<a href="http://dieselserviceasti.it/car-sharing/" class="me-4 text-reset zoom2">
					<i class="fab fa-google"></i>
				</a>
				<a href="https://www.instagram.com/carsharingasti/" class="me-4 text-reset zoom2">
					<i class="fab fa-instagram"></i>
				</a>
				<a href="https://www.linkedin.com/company/astimobilerobotics/" class="me-4 text-reset zoom2">
					<i class="fab fa-linkedin"></i>
				</a>
			</div>
			<!-- Right -->
		</section>
		<!-- Section: Social media -->
		<!-- Section: Links  -->
		<section class="text-white">
			<div class="container text-center text-md-start mt-5">
				<!-- Grid row -->
				<div class="row mt-3">
					<!-- Grid column -->
					<div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
						<!-- Content -->
						<h6 class="text-uppercase fw-bold mb-4">
							<i class="fas fa-gem me-3"></i>GreenShare
						</h6>
						<p>
							GreenShare è un azienda che si occupa di Vehicle
							Sharing con rispetto per l'ambiente, infatti
							puntiamo molto sui mezzi elettrici ed ibridi a
							basso consumo di emissioni di CO2. L'azienda
							vanta più di 210 sedi in tutta Italia e oltre
							23Milioni di utenti.
						</p>
					</div>
					<!-- Grid column -->
					<!-- Grid column -->
					<div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
						<!-- Links -->
						<h6 class="text-uppercase fw-bold mb-4">
							Prodotti
						</h6>
						<p class="zoom2">
							<a href="#!" class="text-reset">Auto elettriche</a>
						</p>
						<p class="zoom2">
							<a href="#!" class="text-reset">Auto</a>
						</p>
						<p class="zoom2">
							<a href="#!" class="text-reset">Monopattini</a>
						</p>
						<p class="zoom2">
							<a href="#!" class="text-reset">Biciclette</a>
						</p>
					</div>
					<!-- Grid column -->
					<div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
						<!-- Links -->
						<h6 class="text-uppercase fw-bold mb-4">
							Contatti
						</h6>
						<p>
							<i class="fas fa-home me-3"></i> Sede: Torino,
							TO 10141, IT
						</p>
						<p>
							<i class="fas fa-envelope me-3"></i>
							GreenShareSrl@azienda.com
						</p>
						<p>
							<i class="fas fa-phone me-3"></i> + 011 234 5678
						</p>
						<p>
							<i class="fas fa-print me-3"></i> + 011 344 5679
						</p>
					</div>
					<!-- Grid column -->
				</div>
				<!-- Grid row -->
			</div>
		</section>
		<!-- Section: Links  -->
		<!-- Copyright -->
		<div class="text-center text-white p-3" style="background-color: rgba(0, 0, 0, 0.05)">
			© 2021 Copyright
			<a class="text-reset fw-bold" href="https://mdbootstrap.com/">GreenShare.com</a>
		</div>
		<!-- Copyright -->
	</footer>
	</div>

	<!-- Imported scripts -->
	<script type="text/javascript" src="js/mdb.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.2/dist/chart.min.js"
		integrity="sha256-D2tkh/3EROq+XuDEmgxOLW1oNxf0rLNlOwsPIUX+co4=" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://unpkg.com/dayjs@1.8.21/dayjs.min.js"></script>

	<!-- Custom scripts -->
	<script th:inline="javascript">
		/*<![CDATA[*/
		var loggedUser = /*[[${loggedUser}]]*/'';
		/*]]>*/

		console.log(loggedUser);

		$().ready(function () {
			$("#new-accordion-item").hide();
			var vehicleId;
			$(".btnDeleteVehicle").on("click", function () {
				vehicleId = $(this).data("vehicle-id");
				$("#btnConfermDeleteVehicle").on("click", function () {
					$.ajax({
						type: "DELETE",
						url: "api/vehicles/delete/" + vehicleId,
						success: function () {
							document.location.href = "dashboard";
						}
					});
				});
			});

			$("#btnAddVehicle").on("click", function () {
				$("#new-accordion-item").slideDown(300, function () {
					$("[data-mdb-target='#flush-collapse-new']").click();

					$("#btnConfermAddVehicle").on("click", function () {
						var vehicleInput = {
							id: null,
							type: $("#newType").val(),
							description: $("#newDescription").val(),
							currentLocation: $("#newCurrentLocation").val(),
							imageUrl: null,
							battery: $("#newBattery").val(),
							maxAutonomy: $("#newMaxAutonomy").val(),
							pricePerMinute: $("#newPricePerMinute").val(),
							creationDate: dayjs().format(),
							createdBy: null
						};
						$.ajax({
							type: "POST",
							url: "api/vehicles/add",
							contentType: "application/json",
							data: JSON.stringify(vehicleInput),
							success: function () {
								document.location.href = "dashboard"
							}
						});
					});
				});
			});
		});
	</script>
</body>

</html>